# üóÑÔ∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL

–ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö Edinorok –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å/–∑–∞–ø–æ–ª–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

---

## üìã –®–∞–≥ 1: –ù–∞–π–¥–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ .env —Ñ–∞–π–ª

```bash
cd backend
cat .env | grep DATABASE_URL
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
DATABASE_URL=postgresql+asyncpg://postgres:password@localhost:5432/edinorok
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ß–µ—Ä–µ–∑ config.py

```bash
cd backend
grep -A 5 "DATABASE_URL" app/config.py
```

---

## üîç –®–∞–≥ 2: –†–∞–∑–±–µ—Ä–∏ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–§–æ—Ä–º–∞—Ç: `postgresql+asyncpg://USERNAME:PASSWORD@HOST:PORT/DATABASE_NAME`

**–ü—Ä–∏–º–µ—Ä:**
```
postgresql+asyncpg://postgres:password@localhost:5432/edinorok
```

–†–∞–∑–±–æ—Ä:
- **USERNAME:** `postgres`
- **PASSWORD:** `password`
- **HOST:** `localhost` (–∏–ª–∏ IP –∞–¥—Ä–µ—Å)
- **PORT:** `5432` (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç PostgreSQL)
- **DATABASE_NAME:** `edinorok`

---

## üîå –®–∞–≥ 3: –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ psql (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

```bash
# –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
psql -U postgres -d edinorok

# –ò–ª–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Ö–æ—Å—Ç–∞ –∏ –ø–æ—Ä—Ç–∞:
psql -h localhost -p 5432 -U postgres -d edinorok

# –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –ø–∞—Ä–æ–ª—å (–≤–≤–µ–¥–∏ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ):
psql -h localhost -p 5432 -U postgres -d edinorok -W
```

**–ü–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É–≤–∏–¥–∏—à—å:**
```
psql (15.0)
Type "help" for help.

edinorok=#
```

### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è
export PGPASSWORD=password

# –ü–æ–¥–∫–ª—é—á–∏—Å—å
psql -h localhost -p 5432 -U postgres -d edinorok
```

### –°–ø–æ—Å–æ–± 3: –ß–µ—Ä–µ–∑ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π —Ñ–æ—Ä–º–∞—Ç PostgreSQL (–±–µ–∑ +asyncpg)
psql "postgresql://postgres:password@localhost:5432/edinorok"
```

---

## ‚úÖ –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑–µ

### 4.1. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä—Ç–∏—Å—Ç–æ–≤

```sql
-- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä—Ç–∏—Å—Ç–æ–≤
SELECT COUNT(*) as total_artists FROM artist_profiles;

-- –ê—Ä—Ç–∏—Å—Ç—ã —Å embeddings
SELECT COUNT(*) as artists_with_embedding 
FROM artist_profiles 
WHERE voice_embedding IS NOT NULL;

-- –ê—Ä—Ç–∏—Å—Ç—ã —Å —Ç–µ–º–±—Ä–æ–º
SELECT COUNT(*) as artists_with_timbre 
FROM artist_profiles 
WHERE timbre_features IS NOT NULL;

-- –ü–æ–ª–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
SELECT 
    COUNT(*) as total,
    COUNT(voice_embedding) as with_embedding,
    COUNT(timbre_features) as with_timbre,
    COUNT(CASE WHEN voice_embedding IS NOT NULL AND timbre_features IS NOT NULL THEN 1 END) as complete
FROM artist_profiles;
```

### 4.2. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Å–µ–Ω

```sql
-- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Å–µ–Ω
SELECT COUNT(*) as total_songs FROM songs;

-- –ü–µ—Å–Ω–∏ —Å –¥–∞–Ω–Ω—ã–º–∏
SELECT 
    COUNT(*) as total,
    COUNT(min_pitch_hz) as with_pitch,
    COUNT(difficulty) as with_difficulty
FROM songs;
```

### 4.3. –ü–æ—Å–º–æ—Ç—Ä–∏ –ø—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–µ—Ä–≤—ã–µ 5 –∞—Ä—Ç–∏—Å—Ç–æ–≤
SELECT id, name, genre, voice_type, 
       CASE WHEN voice_embedding IS NULL THEN '–ù–ï–¢' ELSE '–ï–°–¢–¨' END as has_embedding
FROM artist_profiles 
LIMIT 5;

-- –ü–µ—Ä–≤—ã–µ 5 –ø–µ—Å–µ–Ω
SELECT id, title, artist_id, difficulty, min_pitch_hz, max_pitch_hz
FROM songs 
LIMIT 5;
```

---

## üîß –®–∞–≥ 5: –ï—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞—è - –∑–∞–ø–æ–ª–Ω–∏ –µ—ë

### 5.1. –í—ã–π–¥–∏ –∏–∑ psql

```sql
\q
```

### 5.2. –ó–∞–ø—É—Å—Ç–∏ —Å–∫—Ä–∏–ø—Ç—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏

```bash
cd backend
source venv/bin/activate

# 1. –û–±—Ä–∞–±–æ—Ç–∞–π –∞—Ä—Ç–∏—Å—Ç–æ–≤ (–µ—Å–ª–∏ –µ—Å—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª—ã –≤ backend/artist_vocals/)
python -m scripts.process_artists

# 2. –î–æ–±–∞–≤—å embeddings (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!)
python -m scripts.add_embeddings

# 3. –û–±—Ä–∞–±–æ—Ç–∞–π –ø–µ—Å–Ω–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –≤ backend/songs/)
python -m scripts.process_songs

# 4. –û–±–Ω–æ–≤–∏ –∂–∞–Ω—Ä—ã
python -m scripts.update_genres
```

### 5.3. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```bash
# –°–Ω–æ–≤–∞ –ø–æ–¥–∫–ª—é—á–∏—Å—å –∫ –ë–î
psql -U postgres -d edinorok

# –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ
SELECT COUNT(*) FROM artist_profiles;
SELECT COUNT(*) FROM songs;
```

---

## üõ†Ô∏è –ü–æ–ª–µ–∑–Ω—ã–µ SQL –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–∞–±–ª–∏—Ü

```sql
-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
\dt

-- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã
\d artist_profiles
\d songs
\d voice_analysis_results
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö

```sql
-- –í—Å–µ –∞—Ä—Ç–∏—Å—Ç—ã
SELECT * FROM artist_profiles LIMIT 10;

-- –ê—Ä—Ç–∏—Å—Ç—ã –±–µ–∑ embeddings
SELECT id, name FROM artist_profiles WHERE voice_embedding IS NULL;

-- –ü–µ—Å–Ω–∏ –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö
SELECT id, title FROM songs WHERE min_pitch_hz IS NULL;
```

### –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–û–°–¢–û–†–û–ñ–ù–û!)

```sql
-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞
DELETE FROM voice_analysis_results;

-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ—Ö –∞—Ä—Ç–∏—Å—Ç–æ–≤ (–û–°–¢–û–†–û–ñ–ù–û!)
-- DELETE FROM artist_profiles;

-- –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –ø–µ—Å–Ω–∏ (–û–°–¢–û–†–û–ñ–ù–û!)
-- DELETE FROM songs;
```

---

## üö® –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "password authentication failed"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å –ø–∞—Ä–æ–ª—å –≤ .env —Ñ–∞–π–ª–µ
cat backend/.env | grep DATABASE_URL

# –ò–ª–∏ —Å–±—Ä–æ—Å—å –ø–∞—Ä–æ–ª—å PostgreSQL
sudo -u postgres psql
ALTER USER postgres PASSWORD '–Ω–æ–≤—ã–π_–ø–∞—Ä–æ–ª—å';
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "database does not exist"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –°–æ–∑–¥–∞–π –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
psql -U postgres
CREATE DATABASE edinorok;
\q
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "connection refused"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
# macOS:
brew services list | grep postgresql

# Linux:
sudo systemctl status postgresql

# –ó–∞–ø—É—Å—Ç–∏ –µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω:
# macOS:
brew services start postgresql

# Linux:
sudo systemctl start postgresql
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "permission denied"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –î–∞–π –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
psql -U postgres
GRANT ALL PRIVILEGES ON DATABASE edinorok TO postgres;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO postgres;
\q
```

---

## üìä –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ (—á–µ–∫–ª–∏—Å—Ç)

```sql
-- 1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –±–∞–∑–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
SELECT current_database();

-- 2. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—Ä—Ç–∏—Å—Ç–æ–≤
SELECT COUNT(*) FROM artist_profiles;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0

-- 3. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ —É –∞—Ä—Ç–∏—Å—Ç–æ–≤ –µ—Å—Ç—å embeddings
SELECT COUNT(*) FROM artist_profiles WHERE voice_embedding IS NOT NULL;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0

-- 4. –ü—Ä–æ–≤–µ—Ä—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–µ—Å–µ–Ω
SELECT COUNT(*) FROM songs;
-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0

-- 5. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü
\d artist_profiles
\d songs
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–µ –∫–æ–º–º–∏—Ç—å .env —Ñ–∞–π–ª!

```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ .env –≤ .gitignore
cat .gitignore | grep .env

# –ï—Å–ª–∏ –Ω–µ—Ç - –¥–æ–±–∞–≤—å:
echo "backend/.env" >> .gitignore
```

### –ò—Å–ø–æ–ª—å–∑—É–π –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –í–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞ –ø–∞—Ä–æ–ª—è –≤ –∫–æ–º–∞–Ω–¥–∞—Ö:
export PGPASSWORD=password
psql -U postgres -d edinorok
```

---

## üìù –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞

```bash
# 1. –ù–∞–π–¥–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
cd backend
cat .env | grep DATABASE_URL
# –í—ã–≤–æ–¥: postgresql+asyncpg://postgres:mypassword@localhost:5432/edinorok

# 2. –ü–æ–¥–∫–ª—é—á–∏—Å—å –∫ –ë–î
psql -U postgres -d edinorok
# –í–≤–µ–¥–∏ –ø–∞—Ä–æ–ª—å: mypassword

# 3. –ü—Ä–æ–≤–µ—Ä—å –¥–∞–Ω–Ω—ã–µ
SELECT COUNT(*) FROM artist_profiles;
# –ï—Å–ª–∏ 0 ‚Üí –±–∞–∑–∞ –ø—É—Å—Ç–∞—è

# 4. –í—ã–π–¥–∏ –∏–∑ psql
\q

# 5. –ó–∞–ø–æ–ª–Ω–∏ –±–∞–∑—É
source venv/bin/activate
python -m scripts.process_artists
python -m scripts.add_embeddings
python -m scripts.process_songs

# 6. –ü—Ä–æ–≤–µ—Ä—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
psql -U postgres -d edinorok
SELECT COUNT(*) FROM artist_profiles;
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å > 0
\q
```

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

```bash
# –û–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ–≥–æ:
psql -U postgres -d edinorok -c "
SELECT 
    (SELECT COUNT(*) FROM artist_profiles) as artists,
    (SELECT COUNT(*) FROM artist_profiles WHERE voice_embedding IS NOT NULL) as artists_with_embedding,
    (SELECT COUNT(*) FROM songs) as songs;
"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
 artists | artists_with_embedding | songs 
---------+------------------------+-------
     130 |                    130 |    50
```

–ï—Å–ª–∏ –≤—Å–µ —á–∏—Å–ª–∞ > 0 ‚Üí –±–∞–∑–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ! ‚úÖ

---

**–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.** üéâ
