# Upgrade 10.11

**Дата:** 11.02.2026

---

## Изменения

### 1. Убраны пометки «мужской/женский голос»

Из описаний типов голоса убраны указания на пол. Теперь описания нейтральные:

| Тип голоса | Было | Стало |
|------------|------|-------|
| Бас | Самый низкий **мужской** голос — глубокий и мощный | Самый низкий голос — глубокий и мощный |
| Баритон | Средний **мужской** голос — универсальный | Средний низкий голос — универсальный |
| Тенор | Высокий **мужской** голос — яркий | Высокий голос — яркий |
| Альт | Низкий **женский** голос — тёплый | Низкий высокий голос — тёплый |
| Меццо-сопрано | Средний **женский** голос — гибкий | Средний высокий голос — гибкий |
| Сопрано | Высокий **женский** голос — лёгкий | Самый высокий голос — лёгкий |

**Затронутые файлы:**
- `frontend/src/components/AnalysisResults.jsx` — объект `voiceTypeDescriptions`
- `frontend/src/components/LiveVoiceAnalyzer.jsx` — функция `detectVoiceType`

---

### 2. Фильтр рекомендованных песен — только > 50%

Раньше в рекомендации попадали все песни, включая те, где совпадение диапазона было 30–49%. Теперь показываются только песни с совпадением **выше 50%**.

**Затронутые файлы:**
- `backend/app/core/similarity_engine.py` — метод `recommend_songs()`

---

## FAQ для программистов

### Вопрос: «У некоторых артистов имя не определяется. Он же из метаданных берёт?»

**Нет, имя артиста берётся НЕ из метаданных аудиофайла (не из MP3-тегов).**

Процесс такой:
1. Файлы вокалов кладутся в `backend/artist_vocals/` (например `Adele.mp3`, `Ed Sheeran.wav`)
2. Скрипт `scripts/process_artists.py` парсит **имя файла** через функцию `extract_artist_name_from_filename()` — убирает расширение, заменяет `_` на пробелы
3. Имя сохраняется в БД (таблица `artist_profiles`, поле `name`)
4. При выдаче результатов имя берётся из БД

**Если у артиста не определяется имя — нужно проверить:**
- Как назван файл в `backend/artist_vocals/`
- Есть ли запись в БД (`artist_profiles`)
- Можно задать имя вручную через `ARTISTS_OVERRIDE` в `process_artists.py`

---

### Вопрос: «Как работает выдача рекомендованных песен? Она не анализирует по голосу, а просто выводит песни?»

**Частично верно.** Рекомендации песен **не используют** анализ голоса по тембру/эмбеддингу.

#### Как это работает:

1. **Песни задаются вручную** — список находится в `scripts/add_songs.py`. Для каждой песни вручную указаны: название, диапазон pitch (min/max Hz), сложность. Они загружаются в БД (таблица `songs`).

2. **Рекомендация = совпадение частотного диапазона** — метод `recommend_songs()` в `similarity_engine.py` вызывает `compute_pitch_overlap()`, который вычисляет процент пересечения диапазона голоса пользователя с диапазоном каждой песни. **Больше ничего не учитывается** (ни тембр, ни эмбеддинг, ни жанр).

3. **Это отличается от "Похожих артистов"** — блок «Похожие артисты» использует полноценный анализ:
   - Voice embedding (косинусное сходство) — **50%** веса
   - Pitch overlap (совпадение диапазонов) — **30%** веса
   - Timbre similarity (тембральные характеристики OpenSMILE) — **20%** веса

#### Схема:

```
Запись голоса пользователя
        │
        ├── CREPE (pitch) ──────── min/max Hz
        │                              │
        │                              ├── compute_pitch_overlap() с каждой песней
        │                              │            → Рекомендованные песни (> 50%)
        │                              │
        │                              └── pitch overlap с артистами (30%)
        │
        ├── OpenSMILE (тембр) ──── timbre similarity с артистами (20%)
        │
        └── Voice Embedding ────── cosine similarity с артистами (50%)
                                           │
                                           └── Похожие артисты
```

**Итого:** рекомендации песен — упрощённый механизм (только совпадение частот). Похожие артисты — полноценный анализ голоса.
