# ⚡ Быстрый деплой на сервер

Краткая версия для опытных пользователей.

---

## 1. Установка зависимостей

```bash
sudo apt update && sudo apt install -y python3.11 python3.11-venv postgresql nginx git nodejs
```

## 2. Клонирование

```bash
sudo mkdir -p /var/www/edinorok
sudo chown $USER:$USER /var/www/edinorok
cd /var/www/edinorok
git clone https://github.com/Ilyagerz/simply-quiz.git .
```

## 3. Backend

```bash
cd backend
python3.11 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Создай БД
sudo -u postgres psql -c "CREATE DATABASE edinorok;"
sudo -u postgres psql -c "CREATE USER edinorok_user WITH PASSWORD 'пароль';"
sudo -u postgres psql -c "GRANT ALL PRIVILEGES ON DATABASE edinorok TO edinorok_user;"

# Настрой .env
cp env.example .env
nano .env  # Заполни DATABASE_URL и другие настройки

# Создай директории
mkdir -p uploads songs artist_vocals
```

## 4. Frontend

```bash
cd ../frontend
npm install
npm run build
echo "VITE_API_URL=https://твой_домен.com/api" > .env.production
```

## 5. Systemd сервис

```bash
sudo nano /etc/systemd/system/edinorok-backend.service
```

Вставь:
```ini
[Unit]
Description=Edinorok Backend
After=network.target postgresql.service

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/edinorok/backend
Environment="PATH=/var/www/edinorok/backend/venv/bin"
ExecStart=/var/www/edinorok/backend/venv/bin/uvicorn app.main:app --host 127.0.0.1 --port 8086
Restart=always

[Install]
WantedBy=multi-user.target
```

```bash
sudo systemctl daemon-reload
sudo systemctl enable edinorok-backend
sudo systemctl start edinorok-backend
```

## 6. Nginx

```bash
sudo nano /etc/nginx/sites-available/edinorok
```

Вставь (замени `твой_домен.com`):
```nginx
server {
    listen 80;
    server_name твой_домен.com www.твой_домен.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name твой_домен.com www.твой_домен.com;

    ssl_certificate /etc/letsencrypt/live/твой_домен.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/твой_домен.com/privkey.pem;

    client_max_body_size 50M;

    location / {
        root /var/www/edinorok/frontend/dist;
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://127.0.0.1:8086;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }
}
```

```bash
sudo ln -s /etc/nginx/sites-available/edinorok /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl reload nginx
```

## 7. SSL

```bash
sudo apt install -y certbot python3-certbot-nginx
sudo certbot --nginx -d твой_домен.com -d www.твой_домен.com
```

## 8. Файрвол

```bash
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw allow 22/tcp
sudo ufw enable
```

## 9. Инициализация БД

```bash
cd /var/www/edinorok/backend
source venv/bin/activate
python -c "
import asyncio
from app.db.database import engine, Base

async def init_db():
    async with engine.begin() as conn:
        await conn.run_sync(Base.metadata.create_all)

asyncio.run(init_db())
"
```

## 10. Готово!

Проверь:
- https://твой_домен.com (frontend)
- https://твой_домен.com/api/v1/docs (API docs)

Логи:
```bash
sudo journalctl -u edinorok-backend -f
sudo tail -f /var/log/nginx/edinorok-error.log
```

---

**Полная инструкция:** `ДЕПЛОЙ_НА_СЕРВЕР.md`
